# terraform-aws
### AWS Lambda Deployment with Terraform

This repository contains code and configuration files for deploying an AWS Lambda function using Terraform. Below, you'll find an overview of the updated repository structure and deployment instructions.

[![sequence_diagram.mmd](https://mermaid.ink/img/pako:eNptkU1qwzAQha8itE4uoEWgpC0UXNrUhWwMZipNbZFIdqVRaQi5e0dWTMGNVvPzPumN5iz1YFAqGfErodd4b6EL4Bov-IwQyGo7gidxt6_bbfUkIIpGciI4aeR_XQXuw0D7mLwmO_iifz1Rz3Hpibl3C693dUFysEuY8JZqexyS2QPpvq2GLhbiryhyMXOFvFpfbzZ8qRI1ejO984wxQodFxIU1Kxb2lXgPtuswzN4fflCnyfxELeR8wcKayl5m-CXRmKiQC11---pTiTekYPEbyxxerqTD4MAaXtQ5442kHh1_jeLQQDjkYS-sg0RDffJaKgoJVzKNBmheqlSfcIx4-QWSXaiD?type=png)](https://mermaid-js.github.io/mermaid-live-editor/edit#pako:eNptkU1qwzAQha8itE4uoEWgpC0UXNrUhWwMZipNbZFIdqVRaQi5e0dWTMGNVvPzPumN5iz1YFAqGfErodd4b6EL4Bov-IwQyGo7gidxt6_bbfUkIIpGciI4aeR_XQXuw0D7mLwmO_iifz1Rz3Hpibl3C693dUFysEuY8JZqexyS2QPpvq2GLhbiryhyMXOFvFpfbzZ8qRI1ejO984wxQodFxIU1Kxb2lXgPtuswzN4fflCnyfxELeR8wcKayl5m-CXRmKiQC11---pTiTekYPEbyxxerqTD4MAaXtQ5442kHh1_jeLQQDjkYS-sg0RDffJaKgoJVzKNBmheqlSfcIx4-QWSXaiD)

The diagram above illustrates the flow of AWS CLI commands that trigger a Python Lambda function using an SQS message and how the Lambda function's output can be found in the logs of a particular log group.



## Repository Structure

```
/terraform-aws
├── README.md             # This README file.
├── Makefile              # Makefile for AWS Lambda and Terraform operations and cleanup.
├── payload.py            # Python code for the AWS Lambda function.
├── main.tf               # Terraform configuration for deploying the Lambda function.
├── test_sqs_trigger.sh   # Shell script to test the Lambda function with an SQS trigger.
└── view_lambda_logs.sh   # Shell script to view the logs generated by the Lambda function.
```

## Getting Started

To deploy the AWS Lambda function and associated resources, follow these steps:

1. Make sure you have [Terraform](https://www.terraform.io/) installed. You can refer to external resources for setting up your development environment.

2. Clone this repository to your local machine:

   ```bash
   git clone https://github.com/considerable/terraform-aws.git
   cd terraform-aws
   ```

3. Initialize Terraform and apply the configuration using the Makefile:

   ```bash
   make install_tfenv
   make terraform_init
   make terraform_apply
   ```

4. Once the deployment is complete, you can access the Lambda function and configure triggers as needed.

## Updating `test_sqs_trigger.sh`

To update `test_sqs_trigger.sh` to include your AWS CLI profile and region, open the file in a text editor and replace the following lines:

```bash
# Replace with your AWS CLI profile and region
AWS_PROFILE="default"
AWS_REGION="us-west-2"

# Replace with your SQS queue URL
QUEUE_URL="https://sqs.${AWS_REGION}.amazonaws.com/${AWS_ACCOUNT_NUMBER}/my-main-queue"
```

Replace `"default"` with your AWS CLI profile, `"us-west-2"` with your desired AWS region, and update the `QUEUE_URL` with your SQS queue URL.

## Testing SQS Trigger

To test the Lambda function with an SQS trigger after updating `test_sqs_trigger.sh`, you can run the following command:

```bash
make all && make sqs_trigger
```

This will execute the updated `test_sqs_trigger.sh` script, which will use your specified AWS CLI profile, region, and SQS queue URL for testing.

## Viewing Lambda Logs

To view the logs generated by the Lambda function, you can run the following command:

```bash
make view_logs
```

This will execute the `view_lambda_logs.sh` script, which retrieves and displays the latest log events for the Lambda function.

## Cleaning Up

To remove deployed resources and temporary files, you can use the Makefile's `clean` target:

```bash
make clean
```

This will clean up Lambda deployment artifacts and Terraform state.

## More Details

For more detailed instructions and a deeper understanding of this sort of Terraform and Lambda deployments, consider checking out the LinkedIn Learning course:

[Creating a Dev Environment in AWS with Terraform](https://www.linkedin.com/learning/creating-a-dev-environment-in-aws-with-terraform/course-overview?autoSkip=true&resume=false)

This course provides comprehensive training on setting up a development environment in AWS using Terraform, making it an excellent resource to complement this repository.
